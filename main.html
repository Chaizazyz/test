<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Water Drop Radius Detection</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script async src="https://docs.opencv.org/4.x/opencv.js" type="text/javascript"></script>
    <style>
        body {
            padding: 20px;
        }
        #canvasOutput {
            border: 1px solid black;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-center">Water Drop Radius Detection</h1>
        <div class="form-group">
            <label for="imageUpload">Upload Image:</label>
            <input type="file" class="form-control-file" id="imageUpload" accept="image/*">
        </div>
        <div id="imageContainer" class="text-center"></div>
        <canvas id="canvasOutput"></canvas>
        <div class="mt-3">
            <label for="pressureInput">Pressure Difference (ΔP):</label>
            <input type="number" id="pressureInput" class="form-control" placeholder="Enter pressure difference">
        </div>
        <button id="calculateButton" class="btn btn-primary mt-3">Calculate Surface Tension</button>
        <h3 class="mt-3">Surface Tension (γ): <span id="surfaceTensionOutput"></span></h3>
    </div>

    <script>
        document.getElementById('imageUpload').addEventListener('change', function(e) {
            let file = e.target.files[0];
            let img = new Image();
            img.src = URL.createObjectURL(file);
            img.onload = function() {
                detectWaterDropRadius(img);
            }
        });

        function detectWaterDropRadius(img) {
            let src = cv.imread(img);
            let dst = new cv.Mat();
            let gray = new cv.Mat();
            let circles = new cv.Mat();
            cv.cvtColor(src, gray, cv.COLOR_RGBA2GRAY, 0);
            cv.GaussianBlur(gray, gray, new cv.Size(9, 9), 2, 2);
            cv.HoughCircles(gray, circles, cv.HOUGH_GRADIENT, 1, gray.rows / 8, 100, 30, 0, 0);

            let canvas = document.getElementById('canvasOutput');
            canvas.width = img.width;
            canvas.height = img.height;
            let ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0);

            let radius = 0;
            for (let i = 0; i < circles.cols; ++i) {
                let x = circles.data32F[i * 3];
                let y = circles.data32F[i * 3 + 1];
                radius = circles.data32F[i * 3 + 2];
                ctx.beginPath();
                ctx.arc(x, y, radius, 0, 2 * Math.PI);
                ctx.strokeStyle = 'red';
                ctx.lineWidth = 3;
                ctx.stroke();
            }
            src.delete(); dst.delete(); gray.delete(); circles.delete();

            document.getElementById('calculateButton').onclick = function() {
                let pressureDifference = parseFloat(document.getElementById('pressureInput').value);
                let surfaceTension = (pressureDifference * radius) / 2;
                document.getElementById('surfaceTensionOutput').innerText = surfaceTension.toFixed(2);
            }
        }
    </script>
</body>
</html>
